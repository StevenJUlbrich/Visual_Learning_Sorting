# 09 CI - Optional Pipeline Expectations

Scope: Optional but recommended CI for contract-safe delivery.
Grounded in project stack: Python 3.13 + `uv` + `ruff` + `pyright`.

## 1) CI Goals
- Prevent spec drift by enforcing lint/type/test gates.
- Catch algorithm correctness and contract regressions early.
- Keep merges deterministic and reviewable.

## 2) Minimum CI Gates (Locked)
Each PR should pass:
- Environment sync/install via `uv`.
- Lint: `uv run ruff check .`.
- Typecheck: `uv run pyright`.
- Tests: `uv run pytest -q`.

## 3) Recommended Trigger Policy
- Run on:
  - pull requests targeting default branch.
  - pushes to default branch.
- Optional: manual workflow dispatch for ad-hoc reruns.

## 4) Suggested GitHub Actions Baseline (Optional)

```yaml
name: ci

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install uv
        uses: astral-sh/setup-uv@v4
      - name: Setup Python 3.13
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'
      - name: Sync dependencies
        run: uv sync
      - name: Lint
        run: uv run ruff check .
      - name: Typecheck
        run: uv run pyright
      - name: Tests
        run: uv run pytest -q
```

## 5) Optional Enhancements
- Add matrix for Python patch versions inside 3.13 if needed.
- Add artifact upload for test reports.
- Add coverage threshold gate after test suite stabilizes.

## 6) Merge Expectations
- No direct merge on red pipeline.
- Any waived failure must be documented in PR with:
  - reason,
  - risk assessment,
  - follow-up issue.

## 7) CI Exit Criteria
Pipeline is considered healthy when:
- Recent PRs pass all three quality gates (lint/type/tests).
- No recurring failures in algorithm correctness or generator contract tests.
